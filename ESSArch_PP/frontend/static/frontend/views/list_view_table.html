<div st-table="vm.displayedIps" st-pipe="vm.callServer">
<div class="search-prepare-wrapper">
    <label for items-per-page></label>
    <select id="items-per-page" ng-change="updateIpsPerPage(vm.itemsPerPage)" class="form-control items-per-page"
        ng-model="vm.itemsPerPage" ng-options="x for x in [5,10,20,25,50]" uib-popover="{{'ITEMSPERPAGE' | translate}}" popover-placement="top-left"
        popover-popup-delay="500" popover-append-to-body="true"></select>
    <span class="fa fa-lg fa-filter filter-icon" ng-class="{'blue-border': showAdvancedFilters}" ng-click="toggleAdvancedFilters()"></span>
    <div ng-show="showAdvancedFilters" class="advanced-filters">
        <label>
            <input type="checkbox" ng-model="filterOwnIps" ng-change="vm.toggleOwnIps(filterOwnIps)">
            {{'SEE_MY_IPS' | translate}}
        </label>
        <div ng-repeat="model in filterModels">
            <form name="form[{{$index}}]" style="position: relative;" novalidate ng-init="addFields($index)">
                <div class="formly-buttons-wrapper" ng-class="{'field-no-label': $index !== 0}">
                    <formly-form model="model" fields="filterFields[$index]" options="options[$index]" form="form[$index]">
                    </formly-form>
                    <div class="button-group">
                        <button class="plus-button fa fa-plus btn btn-default" ng-click="addFilterRow($index)"></button>
                        <button class="plus-button btn btn-default fa fa-minus" ng-click="removeForm($index)" ng-if="model.column || filterModels.length > 1"></button>
                    </div>
                </div>
            </form>
        </div>
        <button class="btn btn-default" style="float: right;margin-top: 5px;" ng-click="submitAdvancedFilters()">{{'APPLY' | translate}}</button>
    </div>
    <div ng-if="searchDisabled()" style="width: 50%;" class="input-group margin-bottom-sm">
        <input ng-disabled="true" class="form-control" ng-attr-placeholder="{{'ADVANCED_FILTERS_ON' | translate}}" type="text"
            uib-popover="{{'GLOBALSEARCHDESC' | translate}}" popover-placement="top-left" popover-popup-delay="500" popover-append-to-body="true"
        />
        <span class="input-group-addon clickable" ng-click="initAdvancedFilters(); getListViewData();"><i class="fa fa-lg fa-times" style="color: red;"></i></span>
    </div>
    <div ng-if="!searchDisabled()" style="width: 50%;" class="input-group margin-bottom-sm">
    <input id="search-input" st-search="" class="form-control" ng-attr-placeholder="{{'GLOBALSEARCH' | translate}}" type="text"
        uib-popover="{{'GLOBALSEARCHDESC' | translate}}" popover-placement="top-left" popover-popup-delay="500" popover-append-to-body="true"
    />
        <span ng-if="tableState.search.predicateObject && tableState.search.predicateObject['$']" class="input-group-addon clickable" ng-click="clearSearch(); getListViewData();"><i class="fa fa-lg fa-times" style="color: red;"></i></span>
    </div>
    <button ng-if="'home.access.createDip' | isState" type="button" ng-click="prepareDipModal()" class="btn btn-info" uib-popover="{{'PREPAREDIPDESC' | translate}}"
        popover-placement="top-left" popover-popup-delay="500" popover-append-to-body="true">{{'PREPAREDIP' | translate}}</button>
    <span ng-click="getListViewData()" class="clickable fa fa-refresh fa-lg"
        ng-class="{'fa-refresh-animate': ipLoading }" uib-popover="{{'REFRESHTABLEDESC' | translate}}" popover-placement="left"
        popover-popup-delay="500" popover-append-to-body="true"></span>
</div>
<div id="list-view" class="list-view-table">
    <table class="table table-striped" style="margin-bottom: 0px;">
        <a ng-if="vm.expandAllVisible() && vm.showExpand" ng-click="vm.expandAll()" translate="EXPAND_ALL"></a>
        <a ng-if="vm.expandAllVisible() && !vm.showExpand" ng-click="vm.collapseAll()" translate="COLLAPSE_ALL"></a>
        <a ng-if="('home.ingest.reception' | isState) && includedIps.length" ng-click="vm.uncheckAll()" translate="CLEAR_ALL"></a>
        <thead>
            <tr>
                <th class="clickable" class="column-label"></th>
                <th class="clickable"  ng-if="!(((('home.access.createDip' | isState) || ('home.access.accessIp' | isState)) && col.label == 'filebrowser') || (('home.access.accessIp' | isState) && col.label =='delete'))" class="column-label" st-sort="{{col.sortString}}" st-sort-default="{{col.sortString == 'create_date'? 'reverse' : ''}}" ng-repeat="col in listViewColumns"><span ng-hide="col.label=='step_state' || col.label == 'storage_status'" style="white-space: nowrap;">{{col.label.toUpperCase() | translate}}</span></th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat-start="row in vm.displayedIps" ng-class="{'selected': ip.object_identifier_value == row.object_identifier_value}" class="table-item">
                <td ng-if="'home.ingest.reception' | isState" context-menu="menuOptions('row')">
                    <div class="checkbox table-col">
                        <label>
                            <input ng-disabled="row.state == 'Receiving'" type="checkbox" ng-model="row.checked" ng-change="includeIp(row)" uib-popover="{{'MARKFORRECEIVE' | translate}}" popover-placement="top-left" popover-popup-delay="500" popover-append-to-body="true">
                            </input>
                        </label>
                    </div>
                </td>
                <td ng-if="!('home.ingest.reception' | isState)" class="clickable" ng-click="expandAic(row)"><i class="fa fa-plus" ng-if="row.collapsed && row.information_packages.length > 0"></i><i class="fa fa-minus" ng-if="!row.collapsed && row.information_packages.length > 0"></i></td>
                <td ng-repeat="col in listViewColumns" ng-if="!(((('home.access.createDip' | isState) || ('home.access.accessIp' | isState)) && col.label == 'filebrowser') || (('home.access.accessIp' | isState) && col.label =='delete'))">
                    <div ng-include src="col.template"></div>
                </td>
            </tr>
            <tr ng-if="!row.collapsed" ng-repeat="subrow in row.information_packages"  ng-repeat-end class="table-item" ng-class="{'selected': ip.object_identifier_value == subrow.object_identifier_value}" style="background-color:rgba(50,120,255,.1);">
                <td context-menu="menuOptions('subrow')"></td>
                <td ng-repeat="col in listViewColumns" ng-if="!(((('home.access.createDip' | isState) || ('home.access.accessIp' | isState)) && col.label == 'filebrowser') || (('home.access.accessIp' | isState) && col.label =='delete'))">
                    <div ng-include src="col.template"></div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
    <td ng-show="!initLoad">
        <div class="text-center" st-template="static/frontend/views/pagination.html" st-pagination="" st-items-by-page="vm.itemsPerPage" st-displayed-pages="7"></div>
    </td>
</div>
